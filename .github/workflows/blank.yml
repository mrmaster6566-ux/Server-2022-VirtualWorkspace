name: Windows Server 2022 Workspace

on:
  workflow_dispatch:

jobs:
  setup-workspace:
    runs-on: windows-2022
    timeout-minutes: 360

    steps:
      - name: ðŸ§‘ Create User and Configure Groups
        run: |
          echo ðŸ”§ Initializing Windows Server 2022 Workspace...
          echo ðŸ‘¤ Creating local user 'User'...
          net user User act1-1234 /add
          echo âœ… User 'User' created.

          echo ðŸ” Adding 'User' to Administrators group...
          net localgroup Administrators User /add
          echo âœ… User added to Administrators.

          echo ðŸ” Adding 'User' to Remote Desktop Users group...
          net localgroup "Remote Desktop Users" User /add
          echo âœ… User added to Remote Desktop Users.

      - name: ðŸŽµ Configure Audio Service
        shell: cmd
        run: |
          echo ðŸ”Š Configuring Windows Audio service to start automatically...
          sc config Audiosrv start= auto
          net start Audiosrv
          echo âœ… Audio service configured and started.

      - name: ðŸŒ Install and Configure Tailscale
        shell: cmd
        run: |
          echo ðŸ”§ Downloading and installing Tailscale...
          powershell -Command "Invoke-WebRequest -Uri 'https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe' -OutFile '%USERPROFILE%\\tailscale-setup.exe'"
          "%USERPROFILE%\\tailscale-setup.exe" /quiet
          echo âœ… Tailscale installed.

          echo ðŸ”— Starting Tailscale for secure remote access...
          "%ProgramFiles%\Tailscale\tailscale.exe" up --hostname=windows2022-workspace
          echo âœ… Tailscale is running.

      - name: ðŸ’¬ Display Workspace Info
        run: |
          echo ===============================================
          echo ðŸ¢ Windows Server 2022 Workspace Ready
          echo -----------------------------------------------
          echo ðŸ’» Login Information:
          echo     Username: User
          echo     Password: act1-1234
          echo     RDP access enabled
          echo
          echo ðŸŒ Tailscale hostname: windows2022-workspace
          echo -----------------------------------------------
          echo ðŸŒŸðŸ§¸ðŸ» MADE BY DANIEL 64
          echo ===============================================

      - name: â³ Workspace End Time and 6-Hour Active Session
        run: |
          echo ðŸ• Workspace will remain active until (Minsk time):
          powershell -Command "$tz = [System.TimeZoneInfo]::FindSystemTimeZoneById('FLE Standard Time'); $endTime = [System.TimeZoneInfo]::ConvertTimeBySystemTimeZoneId((Get-Date).AddHours(6), $tz.Id); Write-Host '    ' $endTime"
          echo
          echo ðŸ•’ Keeping Windows Server 2022 workspace active for 6 hours...
          for /L %%i in (1,1,360) do (
              echo â³ Runtime: %%i / 360 minutes elapsed
              timeout /t 60 /nobreak >nul
          )
          echo ðŸ’¤ Workspace session complete â€” shutting down.
